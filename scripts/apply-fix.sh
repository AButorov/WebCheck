#!/bin/bash

# Скрипт для проверки и применения исправления синтаксической ошибки

echo "============================================================"
echo "    Проверка и применение исправления element-selector.js    "
echo "============================================================"
echo

# Переходим в директорию проекта
cd /Users/butorov.ap/Documents/005_Programm/012_TS_vue/002_WebCheck

echo "1. Проверка исправления синтаксической ошибки..."
# Проверяем наличие закрывающей скобки в функции handleClick
if grep -q "setTimeout(selectCurrentElement, 100);\n    }" "src/content-script/element-selector.js"; then
  echo "✅ Синтаксическая ошибка в element-selector.js исправлена"
else
  echo "❌ Внимание: Синтаксическая ошибка в element-selector.js не исправлена!"
  echo "   Пожалуйста, проверьте файл и убедитесь, что закрывающая скобка добавлена"
  exit 1
fi

echo
echo "2. Запуск сборки проекта..."
# Делаем скрипт исполняемым и запускаем
chmod +x ./build.sh
./build.sh

echo
echo "3. Проверка файлов в директории dist..."
if [ -d "dist" ] && [ -f "dist/content-script/element-selector.js" ]; then
  echo "✅ Сборка выполнена успешно"
  
  # Проверка содержимого файла в dist
  if grep -q "setTimeout(selectCurrentElement, 100);\n    }" "dist/content-script/element-selector.js"; then
    echo "✅ Исправленный element-selector.js успешно скопирован в dist"
  else
    echo "⚠️ Предупреждение: Исправления могут быть не полностью скопированы в dist"
    echo "   Рекомендуется выполнить повторную сборку командой ./build.sh"
  fi
else
  echo "❌ Ошибка: Сборка не выполнена или файлы не найдены в директории dist"
  exit 1
fi

echo
echo "============================================================"
echo "    Исправление успешно применено! Что дальше?              "
echo "============================================================"
echo
echo "1. Установка расширения в Chrome:"
echo "   - Откройте chrome://extensions/"
echo "   - Включите режим разработчика (переключатель в правом верхнем углу)"
echo "   - Нажмите 'Загрузить распакованное расширение'"
echo "   - Выберите папку dist"
echo
echo "2. После установки перезапустите браузер"
echo
echo "3. Проверьте работоспособность механизма выбора элементов:"
echo "   - Откройте любую веб-страницу"
echo "   - Нажмите на иконку расширения"
echo "   - Нажмите на кнопку '+' для добавления новой задачи"
echo "   - Убедитесь, что интерфейс выбора элементов отображается на странице"
echo "   - Проверьте, что при наведении на элементы они выделяются"
echo "   - Убедитесь, что при клике на элемент он успешно выбирается"
echo
echo "Если у вас возникнут проблемы, вы можете выполнить отладку в DevTools браузера,"
echo "проверяя сообщения с префиксом [WebCheck:ElementSelector] в консоли."
