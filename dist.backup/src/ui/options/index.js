var _=Object.defineProperty;var i=(t,e)=>_(t,"name",{value:e,configurable:!0});import{b as v}from"../../../assets/js/browser-polyfill.js";import{d as L,r as H,p as G,o as y,B as M,D as N,_ as J,c as h,f as s,g as D,t as n,s as W,w as S,v as E,F as q,m as K,q as Q,n as c,k as f,E as X,G as C,e as Y,H as Z,x as tt,y as et,z as st,A as ot}from"../../../assets/js/ru.js";var nt=L({__name:"App",setup(t){return(e,d)=>{const r=H("router-view");return y(),G(r)}}});const at="0.1.0",rt={version:at},j={en:N,ru:M};function lt(t){try{if(!t)return"";if(window.t&&typeof window.t=="function")try{return window.t(t)}catch(p){console.error("[i18n-helper] Error in window.t:",p)}const e=navigator.language.split("-")[0]||"en",d=j[e]||j.en,r=t.split(".");let l=d;for(const p of r)if(l&&typeof l=="object"&&l!==null&&p in l)l=l[p];else return t;return typeof l=="string"?l:t}catch(e){return console.error("[i18n-helper] Error in translate function:",e),t}}i(lt,"translate");const it="/icons/icon-48.png",dt=L({name:"OptionsPage",setup(){const t=f(rt.version),e=X({...C}),d=f(null),r=f(Z),l=f(!1),p=f(""),o=f(!1),k=f(null);Y(async()=>{await O()});async function O(){try{const a=await v.storage.local.get("settings");a.settings&&Object.assign(e,{...C,...a.settings}),d.value={...e}}catch(a){console.error("Ошибка при загрузке настроек:",a),g("Ошибка при загрузке настроек. Используются значения по умолчанию.")}}i(O,"loadSettings");async function I(){try{await v.storage.local.set({settings:e}),d.value={...e},g("Настройки успешно сохранены")}catch(a){console.error("Ошибка при сохранении настроек:",a),g("Ошибка при сохранении настроек")}}i(I,"saveSettings");function U(){d.value&&Object.assign(e,d.value)}i(U,"resetForm");function $(){confirm("Вы уверены, что хотите сбросить все настройки до значений по умолчанию?")&&(Object.assign(e,C),I())}i($,"resetSettings");function P(){if(confirm("ВНИМАНИЕ: Это действие нельзя отменить. Вы уверены, что хотите удалить ВСЕ данные?"))try{v.storage.local.clear(),Object.assign(e,C),g("Все данные успешно удалены")}catch(a){console.error("Ошибка при удалении данных:",a),g("Ошибка при удалении данных")}}i(P,"clearAllData");function B(a){const b=a.target.files[0];b&&(k.value=b)}i(B,"handleFileUpload");function z(){if(!k.value)return;const a=new FileReader;a.onload=async b=>{try{const u=JSON.parse(b.target.result);if(!u||!u.settings&&!u.tasks)throw new Error("Недопустимый формат файла");u.settings&&(await v.storage.local.set({settings:u.settings}),Object.assign(e,u.settings)),u.tasks&&await v.storage.local.set({tasks:u.tasks}),o.value=!1,g("Данные успешно импортированы")}catch(u){console.error("Ошибка при импорте данных:",u),g("Ошибка при импорте данных. Проверьте формат файла.")}},a.readAsText(k.value)}i(z,"importData");async function V(){try{const a=await v.storage.local.get(null),b=JSON.stringify(a,null,2),u=new Blob([b],{type:"application/json"}),T=URL.createObjectURL(u),w=document.createElement("a");w.href=T,w.download=`web-check-export-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(w),w.click(),setTimeout(()=>{document.body.removeChild(w),URL.revokeObjectURL(T)},100),g("Данные успешно экспортированы")}catch(a){console.error("Ошибка при экспорте данных:",a),g("Ошибка при экспорте данных")}}i(V,"exportData");function g(a){p.value=a,l.value=!0,setTimeout(()=>{l.value=!1},3e3)}return i(g,"showMessage"),{version:t,settings:e,availableLanguages:r,showSuccessMessage:l,successMessage:p,showImportDialog:o,importFile:k,loadSettings:O,saveSettings:I,resetForm:U,resetSettings:$,clearAllData:P,handleFileUpload:B,importData:z,exportData:V,showMessage:g,translate:lt}}}),ut={class:"options-page bg-white min-h-screen p-6"},gt={class:"mb-8"},mt={class:"flex items-center justify-between mb-4"},pt={class:"text-2xl font-bold text-gray-900"},ct={class:"flex items-center"},ft={class:"text-sm text-gray-500"},bt={class:"max-w-3xl mx-auto"},vt={class:"bg-gray-50 p-6 rounded-lg shadow-sm"},yt={class:"text-lg font-semibold text-gray-800 mb-4"},wt={class:"mb-4"},ht={for:"language",class:"block text-sm font-medium text-gray-700 mb-1"},xt=["value"],kt={class:"mb-4"},Ct={for:"defaultInterval",class:"block text-sm font-medium text-gray-700 mb-1"},St={value:"15m"},Ot={value:"1h"},It={value:"3h"},Tt={value:"1d"},Dt={class:"mb-4"},Et={for:"maxTasks",class:"block text-sm font-medium text-gray-700 mb-1"},jt={class:"relative mt-1 rounded-md shadow-sm"},At={class:"bg-gray-50 p-6 rounded-lg shadow-sm"},Lt={class:"text-lg font-semibold text-gray-800 mb-4"},Mt={class:"flex items-center justify-between mb-4"},Nt={for:"notifications",class:"text-sm font-medium text-gray-700"},Ft={class:"flex items-center justify-between mb-4"},Rt={class:"flex items-center justify-between"},Ut={class:"bg-gray-50 p-6 rounded-lg shadow-sm"},$t={class:"text-lg font-semibold text-gray-800 mb-4"},Pt={class:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3"},Bt={class:"flex justify-end space-x-3"},zt={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-[#2d6cdf] rounded-md shadow-sm hover:bg-blue-700"},Vt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"},_t={class:"bg-white rounded-lg shadow-xl max-w-md w-full p-6"},Ht={class:"mb-4"},Gt={class:"flex justify-end space-x-3"},Jt=["disabled"],Wt={key:1,class:"fixed bottom-4 right-4 bg-green-50 border-l-4 border-green-500 p-4 rounded shadow-md"},qt={class:"flex"},Kt={class:"ml-3"},Qt={class:"text-sm text-green-700"};function Xt(t,e,d,r,l,p){return y(),h("div",ut,[s("header",gt,[s("div",mt,[s("h1",pt,n(t.translate("options.title")),1),s("div",ct,[e[15]||(e[15]=s("img",{src:it,alt:"Web Check Logo",class:"h-10 w-10 mr-2"},null,-1)),s("span",ft,"Версия "+n(t.version),1)])]),e[16]||(e[16]=s("div",{class:"h-0.5 bg-gray-200 w-full"},null,-1))]),s("main",bt,[s("form",{class:"space-y-8",onSubmit:e[11]||(e[11]=W((...o)=>t.saveSettings&&t.saveSettings(...o),["prevent"]))},[s("div",vt,[s("h2",yt,n(t.translate("options.general")),1),s("div",wt,[s("label",ht,n(t.translate("options.language")),1),S(s("select",{id:"language","onUpdate:modelValue":e[0]||(e[0]=o=>t.settings.language=o),class:"w-full p-2 border border-gray-300 rounded-md shadow-sm text-sm"},[(y(!0),h(q,null,K(t.availableLanguages,o=>(y(),h("option",{key:o.code,value:o.code},n(o.name),9,xt))),128))],512),[[E,t.settings.language]])]),s("div",kt,[s("label",Ct,n(t.translate("options.defaultInterval")),1),S(s("select",{id:"defaultInterval","onUpdate:modelValue":e[1]||(e[1]=o=>t.settings.defaultInterval=o),class:"w-full p-2 border border-gray-300 rounded-md shadow-sm text-sm"},[s("option",St,n(t.translate("popup.taskCard.intervals.15m")),1),s("option",Ot,n(t.translate("popup.taskCard.intervals.1h")),1),s("option",It,n(t.translate("popup.taskCard.intervals.3h")),1),s("option",Tt,n(t.translate("popup.taskCard.intervals.1d")),1)],512),[[E,t.settings.defaultInterval]])]),s("div",Dt,[s("label",Et,n(t.translate("options.maxTasks")),1),s("div",jt,[S(s("input",{id:"maxTasks","onUpdate:modelValue":e[2]||(e[2]=o=>t.settings.maxTasks=o),type:"number",min:"1",max:"20",class:"w-full p-2 border border-gray-300 rounded-md shadow-sm text-sm"},null,512),[[Q,t.settings.maxTasks]])]),e[17]||(e[17]=s("p",{class:"mt-1 text-xs text-gray-500"}," Значение от 1 до 20 задач ",-1))])]),s("div",At,[s("h2",Lt,n(t.translate("options.notifications")),1),s("div",Mt,[s("div",null,[s("label",Nt,n(t.translate("options.enableNotifications")),1),e[18]||(e[18]=s("p",{class:"text-xs text-gray-500"}," Показывать всплывающие уведомления при обнаружении изменений ",-1))]),s("div",null,[s("button",{type:"button",class:c(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",t.settings.notifications?"bg-blue-600":"bg-gray-300"]),onClick:e[3]||(e[3]=o=>t.settings.notifications=!t.settings.notifications)},[s("span",{class:c(["inline-block h-4 w-4 rounded-full bg-white transition-transform",t.settings.notifications?"translate-x-6":"translate-x-1"])},null,2)],2)])]),s("div",Ft,[e[19]||(e[19]=s("div",null,[s("label",{for:"badgeCounter",class:"text-sm font-medium text-gray-700"}," Счетчик на иконке "),s("p",{class:"text-xs text-gray-500"}," Показывать количество найденных изменений на иконке расширения ")],-1)),s("div",null,[s("button",{type:"button",class:c(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",t.settings.badgeCounter?"bg-blue-600":"bg-gray-300"]),onClick:e[4]||(e[4]=o=>t.settings.badgeCounter=!t.settings.badgeCounter)},[s("span",{class:c(["inline-block h-4 w-4 rounded-full bg-white transition-transform",t.settings.badgeCounter?"translate-x-6":"translate-x-1"])},null,2)],2)])]),s("div",Rt,[e[20]||(e[20]=s("div",null,[s("label",{for:"autoResume",class:"text-sm font-medium text-gray-700"}," Автоматическое возобновление "),s("p",{class:"text-xs text-gray-500"}," Автоматически возобновлять отслеживание при запуске браузера ")],-1)),s("div",null,[s("button",{type:"button",class:c(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",t.settings.autoResume?"bg-blue-600":"bg-gray-300"]),onClick:e[5]||(e[5]=o=>t.settings.autoResume=!t.settings.autoResume)},[s("span",{class:c(["inline-block h-4 w-4 rounded-full bg-white transition-transform",t.settings.autoResume?"translate-x-6":"translate-x-1"])},null,2)],2)])])]),s("div",Ut,[s("h2",$t,n(t.translate("options.data")),1),s("div",Pt,[s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50",onClick:e[6]||(e[6]=(...o)=>t.resetSettings&&t.resetSettings(...o))},n(t.translate("options.resetSettings")),1),s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50",onClick:e[7]||(e[7]=(...o)=>t.exportData&&t.exportData(...o))},n(t.translate("options.exportData")),1),s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50",onClick:e[8]||(e[8]=o=>t.showImportDialog=!0)},n(t.translate("options.importData")),1),s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-red-600 rounded-md shadow-sm hover:bg-red-700",onClick:e[9]||(e[9]=(...o)=>t.clearAllData&&t.clearAllData(...o))},n(t.translate("options.resetData")),1)])]),s("div",Bt,[s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50",onClick:e[10]||(e[10]=(...o)=>t.resetForm&&t.resetForm(...o))},n(t.translate("options.cancel")),1),s("button",zt,n(t.translate("options.saveSettings")),1)])],32)]),t.showImportDialog?(y(),h("div",Vt,[s("div",_t,[e[21]||(e[21]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"}," Импорт данных ",-1)),e[22]||(e[22]=s("p",{class:"text-sm text-gray-600 mb-4"}," Загрузите файл экспорта данных Web Check. Это заменит все ваши текущие настройки и задачи. ",-1)),s("div",Ht,[s("input",{type:"file",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",onChange:e[12]||(e[12]=(...o)=>t.handleFileUpload&&t.handleFileUpload(...o))},null,32)]),s("div",Gt,[s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50",onClick:e[13]||(e[13]=o=>t.showImportDialog=!1)}," Отмена "),s("button",{type:"button",disabled:!t.importFile,class:c(["px-4 py-2 text-sm font-medium text-white rounded-md shadow-sm",t.importFile?"bg-[#2d6cdf] hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"]),onClick:e[14]||(e[14]=(...o)=>t.importData&&t.importData(...o))}," Импортировать ",10,Jt)])])])):D("",!0),t.showSuccessMessage?(y(),h("div",Wt,[s("div",qt,[e[23]||(e[23]=s("div",{class:"flex-shrink-0"},[s("svg",{class:"h-5 w-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","fill-rule":"evenodd","clip-rule":"evenodd"})])],-1)),s("div",Kt,[s("p",Qt,n(t.successMessage),1)])])])):D("",!0)])}i(Xt,"_sfc_render");const Yt=J(dt,[["render",Xt]]),Zt=[{path:"/",name:"index",component:Yt}],F=tt({history:et(),routes:Zt});window.vueRouter=F;var te=F;const m=i((t,...e)=>{console.log(`[OPTIONS] ${t}`,...e)},"log");m("Starting options page initialization...");const ee=navigator.language.split("-")[0]||"en",A={en:N,ru:M},R=i(t=>{try{if(!t)return"";const e=A[ee]||A.en,d=t.split(".");let r=e;for(const l of d)if(r&&typeof r=="object"&&!Array.isArray(r)&&l in r)r=r[l];else return t;return typeof r=="string"?r:t}catch(e){return console.error("[OPTIONS] Translation error:",e),t||""}},"t");window.t=R;m("i18n function added to window before app creation");const x=st(nt);x.use(te);m("Router attached");const se=ot();x.use(se);m("Pinia attached");x.config.globalProperties.$t=R;m("Translation function attached to app.config.globalProperties");x.config.errorHandler=(t,e,d)=>{console.error("[OPTIONS] Error:",t),console.error("[OPTIONS] Info:",d),console.error("[OPTIONS] Instance:",e);const r=document.getElementById("app");if(r){const l=t instanceof Error?t.message:"Неизвестная ошибка";r.innerHTML=`
      <div style="padding: 20px; color: #e53e3e; background: #fff5f5; border: 1px solid #fc8181; border-radius: 5px; margin: 20px;">
        <h3 style="font-weight: bold; margin-bottom: 10px;">Ошибка загрузки</h3>
        <p>${l}</p>
        <p style="margin-top: 10px; font-size: 14px; color: #718096;">
          Попробуйте перезапустить расширение
        </p>
      </div>
    `}};try{document.getElementById("app")?(x.mount("#app"),m("App mounted successfully")):m("Error: #app element not found!")}catch(t){const e=t instanceof Error?t.message:"Unknown error";console.error("[OPTIONS] Mount error:",e)}window.addEventListener("load",()=>{m("Page fully loaded"),m("window.t is "+(typeof window.t=="function"?"available":"NOT available"))});
